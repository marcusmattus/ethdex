{"ast":null,"code":"\"use strict\";\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function () {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.lowerCaseAddresses = exports.getEtherscanWalletURL = exports.getEtherscanURL = exports.parseUrl = exports.numberToBytes32 = exports.getTimestamp = exports.toAtomicString = exports.toDecimalString = exports.getBestByHighestSenderAmount = exports.getBestByHighestSignerAmount = exports.getBestByLowestSignerAmount = exports.getBestByLowestSenderAmount = exports.calculateCostFromLevels = exports.calculateCost = exports.claimPropsToStrings = exports.claimToParams = exports.isValidClaim = exports.getSignerFromClaimSignature = exports.createClaimSignature = exports.createClaim = exports.orderPropsToStrings = exports.orderToParams = exports.isValidOrder = exports.getSignerFromSwapSignature = exports.createSwapSignature = exports.createOrder = void 0;\n/* eslint-disable @typescript-eslint/explicit-module-boundary-types */\n\nvar ethUtil = __importStar(require(\"ethereumjs-util\"));\n\nvar sigUtil = __importStar(require(\"eth-sig-util\"));\n\nvar ethers_1 = require(\"ethers\");\n\nvar url = __importStar(require(\"url\"));\n\nvar bignumber_js_1 = __importDefault(require(\"bignumber.js\"));\n\nvar constants_1 = require(\"@airswap/constants\");\n\nvar typescript_1 = require(\"@airswap/typescript\"); // eslint-disable-next-line  @typescript-eslint/explicit-module-boundary-types\n\n\nfunction createOrder(_a) {\n  var _b = _a.expiry,\n      expiry = _b === void 0 ? Math.round(Date.now() / 1000 + constants_1.SECONDS_IN_DAY).toString() : _b,\n      _c = _a.nonce,\n      nonce = _c === void 0 ? Date.now().toString() : _c,\n      _d = _a.signerWallet,\n      signerWallet = _d === void 0 ? constants_1.ADDRESS_ZERO : _d,\n      _e = _a.signerToken,\n      signerToken = _e === void 0 ? constants_1.ADDRESS_ZERO : _e,\n      _f = _a.signerAmount,\n      signerAmount = _f === void 0 ? '0' : _f,\n      _g = _a.protocolFee,\n      protocolFee = _g === void 0 ? '0' : _g,\n      _h = _a.senderWallet,\n      senderWallet = _h === void 0 ? constants_1.ADDRESS_ZERO : _h,\n      _j = _a.senderToken,\n      senderToken = _j === void 0 ? constants_1.ADDRESS_ZERO : _j,\n      _k = _a.senderAmount,\n      senderAmount = _k === void 0 ? '0' : _k;\n  return {\n    expiry: String(expiry),\n    nonce: String(nonce),\n    signerWallet: signerWallet,\n    signerToken: signerToken,\n    signerAmount: String(signerAmount),\n    protocolFee: String(protocolFee),\n    senderWallet: senderWallet,\n    senderToken: senderToken,\n    senderAmount: String(senderAmount)\n  };\n}\n\nexports.createOrder = createOrder;\n\nfunction createSwapSignature(unsignedOrder, signer, swapContract, chainId) {\n  return __awaiter(this, void 0, void 0, function () {\n    var sig, _a, r, s, v;\n\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          if (!(typeof signer === 'string')) return [3\n          /*break*/\n          , 1];\n          sig = sigUtil.signTypedData_v4(ethUtil.toBuffer(signer), {\n            data: {\n              types: typescript_1.EIP712Swap,\n              domain: {\n                name: constants_1.DOMAIN_NAME_SWAP,\n                version: constants_1.DOMAIN_VERSION_SWAP,\n                chainId: chainId,\n                verifyingContract: swapContract\n              },\n              primaryType: 'Order',\n              message: unsignedOrder\n            }\n          });\n          return [3\n          /*break*/\n          , 3];\n\n        case 1:\n          return [4\n          /*yield*/\n          , signer._signTypedData({\n            name: constants_1.DOMAIN_NAME_SWAP,\n            version: constants_1.DOMAIN_VERSION_SWAP,\n            chainId: chainId,\n            verifyingContract: swapContract\n          }, {\n            Order: typescript_1.EIP712Swap.Order\n          }, unsignedOrder)];\n\n        case 2:\n          sig = _b.sent();\n          _b.label = 3;\n\n        case 3:\n          _a = ethers_1.ethers.utils.splitSignature(sig), r = _a.r, s = _a.s, v = _a.v;\n          return [2\n          /*return*/\n          , {\n            r: r,\n            s: s,\n            v: String(v)\n          }];\n      }\n    });\n  });\n}\n\nexports.createSwapSignature = createSwapSignature;\n\nfunction getSignerFromSwapSignature(order, swapContract, chainId, v, r, s) {\n  var sig = \"\".concat(r).concat(s.slice(2)).concat(ethers_1.ethers.BigNumber.from(v).toHexString().slice(2));\n  return sigUtil.recoverTypedSignature_v4({\n    data: {\n      types: typescript_1.EIP712Swap,\n      domain: {\n        name: constants_1.DOMAIN_NAME_SWAP,\n        version: constants_1.DOMAIN_VERSION_SWAP,\n        chainId: chainId,\n        verifyingContract: swapContract\n      },\n      primaryType: 'Order',\n      message: order\n    },\n    sig: sig\n  });\n}\n\nexports.getSignerFromSwapSignature = getSignerFromSwapSignature;\n\nfunction isValidOrder(order) {\n  return order && 'nonce' in order && 'expiry' in order && 'signerWallet' in order && 'signerToken' in order && 'signerAmount' in order && 'senderToken' in order && 'senderAmount' in order && 'r' in order && 's' in order && 'v' in order;\n}\n\nexports.isValidOrder = isValidOrder;\n\nfunction orderToParams(order) {\n  return [order.nonce, order.expiry, order.signerWallet, order.signerToken, order.signerAmount, order.senderToken, order.senderAmount, order.v, order.r, order.s];\n}\n\nexports.orderToParams = orderToParams;\n\nfunction orderPropsToStrings(obj) {\n  return {\n    nonce: String(obj.nonce),\n    expiry: String(obj.expiry),\n    signerWallet: String(obj.signerWallet),\n    signerToken: String(obj.signerToken),\n    signerAmount: String(obj.signerAmount),\n    senderToken: String(obj.senderToken),\n    senderAmount: String(obj.senderAmount),\n    v: String(obj.v),\n    r: String(obj.r),\n    s: String(obj.s)\n  };\n}\n\nexports.orderPropsToStrings = orderPropsToStrings; // eslint-disable-next-line  @typescript-eslint/explicit-module-boundary-types\n\nfunction createClaim(_a) {\n  var _b = _a.nonce,\n      nonce = _b === void 0 ? Date.now().toString() : _b,\n      _c = _a.participant,\n      participant = _c === void 0 ? constants_1.ADDRESS_ZERO : _c,\n      _d = _a.score,\n      score = _d === void 0 ? '0' : _d;\n  return {\n    nonce: String(nonce),\n    participant: participant,\n    score: String(score)\n  };\n}\n\nexports.createClaim = createClaim;\n\nfunction createClaimSignature(unsignedClaim, signer, poolContract, chainId) {\n  return __awaiter(this, void 0, void 0, function () {\n    var sig, _a, r, s, v;\n\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          if (!(typeof signer === 'string')) return [3\n          /*break*/\n          , 1];\n          sig = sigUtil.signTypedData_v4(ethUtil.toBuffer(signer), {\n            data: {\n              types: typescript_1.EIP712Claim,\n              domain: {\n                name: constants_1.DOMAIN_NAME_POOL,\n                version: constants_1.DOMAIN_VERSION_POOL,\n                chainId: chainId,\n                verifyingContract: poolContract\n              },\n              primaryType: 'Claim',\n              message: unsignedClaim\n            }\n          });\n          return [3\n          /*break*/\n          , 3];\n\n        case 1:\n          return [4\n          /*yield*/\n          , signer._signTypedData({\n            name: constants_1.DOMAIN_NAME_POOL,\n            version: constants_1.DOMAIN_VERSION_POOL,\n            chainId: chainId,\n            verifyingContract: poolContract\n          }, {\n            Claim: typescript_1.EIP712Claim.Claim\n          }, unsignedClaim)];\n\n        case 2:\n          sig = _b.sent();\n          _b.label = 3;\n\n        case 3:\n          _a = ethers_1.ethers.utils.splitSignature(sig), r = _a.r, s = _a.s, v = _a.v;\n          return [2\n          /*return*/\n          , {\n            r: r,\n            s: s,\n            v: String(v)\n          }];\n      }\n    });\n  });\n}\n\nexports.createClaimSignature = createClaimSignature;\n\nfunction getSignerFromClaimSignature(claim, poolContract, chainId, v, r, s) {\n  var sig = \"\".concat(r).concat(s.slice(2)).concat(ethers_1.ethers.BigNumber.from(v).toHexString().slice(2));\n  return sigUtil.recoverTypedSignature_v4({\n    data: {\n      types: typescript_1.EIP712Claim,\n      domain: {\n        name: constants_1.DOMAIN_NAME_POOL,\n        version: constants_1.DOMAIN_VERSION_POOL,\n        chainId: chainId,\n        verifyingContract: poolContract\n      },\n      primaryType: 'Claim',\n      message: claim\n    },\n    sig: sig\n  });\n}\n\nexports.getSignerFromClaimSignature = getSignerFromClaimSignature;\n\nfunction isValidClaim(claim) {\n  return claim && 'nonce' in claim && 'participant' in claim && 'score' in claim && 'r' in claim && 's' in claim && 'v' in claim;\n}\n\nexports.isValidClaim = isValidClaim;\n\nfunction claimToParams(claim) {\n  return [claim.nonce, claim.participant, claim.score, claim.v, claim.r, claim.s];\n}\n\nexports.claimToParams = claimToParams;\n\nfunction claimPropsToStrings(obj) {\n  return {\n    nonce: String(obj.nonce),\n    participant: String(obj.participant),\n    score: String(obj.score),\n    v: String(obj.v),\n    r: String(obj.r),\n    s: String(obj.s)\n  };\n}\n\nexports.claimPropsToStrings = claimPropsToStrings;\n\nfunction calculateCost(amount, pricing) {\n  // TODO: Formula support\n  if (typeof pricing !== 'string') {\n    return calculateCostFromLevels(amount, pricing);\n  }\n\n  return null;\n}\n\nexports.calculateCost = calculateCost;\n\nfunction calculateCostFromLevels(amount, levels) {\n  var totalAmount = new bignumber_js_1.default(amount);\n  var totalAvailable = new bignumber_js_1.default(levels[levels.length - 1][0]);\n  var totalCost = new bignumber_js_1.default(0);\n  var previousLevel = new bignumber_js_1.default(0);\n\n  if (totalAmount.gt(totalAvailable)) {\n    throw new Error(\"Requested amount (\".concat(totalAmount.toFixed(), \") exceeds maximum available (\").concat(totalAvailable.toFixed(), \").\"));\n  } // Steps through levels and multiplies each incremental amount by the level price\n  // Levels takes the form of [[ level, price ], ... ] as in [[ '100', '0.5' ], ... ]\n\n\n  for (var i = 0; i < levels.length; i++) {\n    var incrementalAmount = void 0;\n\n    if (totalAmount.gt(new bignumber_js_1.default(levels[i][0]))) {\n      incrementalAmount = new bignumber_js_1.default(levels[i][0]).minus(previousLevel);\n    } else {\n      incrementalAmount = new bignumber_js_1.default(totalAmount).minus(previousLevel);\n    }\n\n    totalCost = totalCost.plus(new bignumber_js_1.default(incrementalAmount).multipliedBy(levels[i][1]));\n    previousLevel = new bignumber_js_1.default(levels[i][0]);\n    if (totalAmount.lt(previousLevel)) break;\n  }\n\n  return totalCost.decimalPlaces(6).toFixed();\n}\n\nexports.calculateCostFromLevels = calculateCostFromLevels;\n\nfunction getLowest(objects, key) {\n  var best;\n  var bestAmount;\n  var amount;\n\n  for (var _i = 0, objects_1 = objects; _i < objects_1.length; _i++) {\n    var obj = objects_1[_i];\n    if (!obj[key]) continue;\n\n    if (obj[key].amount != undefined) {\n      // if its a quote, it has .amount\n      amount = ethers_1.ethers.BigNumber.from(obj[key].amount);\n    } else {\n      // if its an order, it has .data\n      amount = ethers_1.ethers.BigNumber.from(obj[key].data.slice(0, 66));\n    }\n\n    if (!best || amount.lt(bestAmount)) {\n      bestAmount = amount;\n      best = obj;\n    }\n  }\n\n  return best;\n}\n\nfunction getHighest(objects, key) {\n  var best;\n  var bestAmount;\n  var amount;\n\n  for (var _i = 0, objects_2 = objects; _i < objects_2.length; _i++) {\n    var obj = objects_2[_i];\n    if (!obj[key]) continue;\n\n    if (obj[key].amount != undefined) {\n      // if its a quote, it has .amount\n      amount = ethers_1.ethers.BigNumber.from(obj[key].amount);\n    } else {\n      // if its an order, it has .data\n      amount = ethers_1.ethers.BigNumber.from(obj[key].data.slice(0, 66));\n    }\n\n    if (!best || amount.gt(bestAmount)) {\n      bestAmount = amount;\n      best = obj;\n    }\n  }\n\n  return best;\n}\n\nfunction getBestByLowestSenderAmount(objects) {\n  return getLowest(objects, 'sender');\n}\n\nexports.getBestByLowestSenderAmount = getBestByLowestSenderAmount;\n\nfunction getBestByLowestSignerAmount(objects) {\n  return getLowest(objects, 'signer');\n}\n\nexports.getBestByLowestSignerAmount = getBestByLowestSignerAmount;\n\nfunction getBestByHighestSignerAmount(objects) {\n  return getHighest(objects, 'signer');\n}\n\nexports.getBestByHighestSignerAmount = getBestByHighestSignerAmount;\n\nfunction getBestByHighestSenderAmount(objects) {\n  return getHighest(objects, 'sender');\n}\n\nexports.getBestByHighestSenderAmount = getBestByHighestSenderAmount;\n\nfunction toDecimalString(value, decimals) {\n  return ethers_1.ethers.utils.formatUnits(value.toString(), decimals).toString();\n}\n\nexports.toDecimalString = toDecimalString;\n\nfunction toAtomicString(value, decimals) {\n  return ethers_1.ethers.utils.parseUnits(value.toString(), decimals).toString();\n}\n\nexports.toAtomicString = toAtomicString;\n\nfunction getTimestamp() {\n  return Math.round(Date.now() / 1000).toString();\n}\n\nexports.getTimestamp = getTimestamp;\n\nfunction numberToBytes32(number) {\n  var hexString = number.toString(16);\n  return \"0x\".concat(hexString.padStart(64, '0'));\n}\n\nexports.numberToBytes32 = numberToBytes32;\n\nfunction parseUrl(locator) {\n  if (!/(http|ws)s?:\\/\\//.test(locator)) {\n    locator = \"https://\".concat(locator);\n  }\n\n  return url.parse(locator);\n}\n\nexports.parseUrl = parseUrl;\n\nfunction getEtherscanURL(chainId, hash) {\n  return \"https://\".concat(constants_1.etherscanDomains[chainId], \"/tx/\").concat(hash);\n}\n\nexports.getEtherscanURL = getEtherscanURL;\n\nfunction getEtherscanWalletURL(chainId, address) {\n  return \"https://\".concat(constants_1.etherscanDomains[chainId], \"/address/\").concat(address);\n}\n\nexports.getEtherscanWalletURL = getEtherscanWalletURL;\n\nfunction lowerCaseAddresses(obj) {\n  for (var key in obj) {\n    if (typeof obj[key] === 'object') {\n      lowerCaseAddresses(obj[key]);\n    } else if (typeof obj[key] === 'string' && obj[key].indexOf('0x') === 0) {\n      obj[key] = obj[key].toLowerCase();\n    } else {\n      obj[key] = obj[key].toString();\n    }\n  }\n\n  return obj;\n}\n\nexports.lowerCaseAddresses = lowerCaseAddresses;","map":{"version":3,"sources":["../index.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.lowerCaseAddresses = exports.getEtherscanWalletURL = exports.getEtherscanURL = exports.parseUrl = exports.numberToBytes32 = exports.getTimestamp = exports.toAtomicString = exports.toDecimalString = exports.getBestByHighestSenderAmount = exports.getBestByHighestSignerAmount = exports.getBestByLowestSignerAmount = exports.getBestByLowestSenderAmount = exports.calculateCostFromLevels = exports.calculateCost = exports.claimPropsToStrings = exports.claimToParams = exports.isValidClaim = exports.getSignerFromClaimSignature = exports.createClaimSignature = exports.createClaim = exports.orderPropsToStrings = exports.orderToParams = exports.isValidOrder = exports.getSignerFromSwapSignature = exports.createSwapSignature = exports.createOrder = void 0;\n/* eslint-disable @typescript-eslint/explicit-module-boundary-types */\nvar ethUtil = __importStar(require(\"ethereumjs-util\"));\nvar sigUtil = __importStar(require(\"eth-sig-util\"));\nvar ethers_1 = require(\"ethers\");\nvar url = __importStar(require(\"url\"));\nvar bignumber_js_1 = __importDefault(require(\"bignumber.js\"));\nvar constants_1 = require(\"@airswap/constants\");\nvar typescript_1 = require(\"@airswap/typescript\");\n// eslint-disable-next-line  @typescript-eslint/explicit-module-boundary-types\nfunction createOrder(_a) {\n    var _b = _a.expiry, expiry = _b === void 0 ? Math.round(Date.now() / 1000 + constants_1.SECONDS_IN_DAY).toString() : _b, _c = _a.nonce, nonce = _c === void 0 ? Date.now().toString() : _c, _d = _a.signerWallet, signerWallet = _d === void 0 ? constants_1.ADDRESS_ZERO : _d, _e = _a.signerToken, signerToken = _e === void 0 ? constants_1.ADDRESS_ZERO : _e, _f = _a.signerAmount, signerAmount = _f === void 0 ? '0' : _f, _g = _a.protocolFee, protocolFee = _g === void 0 ? '0' : _g, _h = _a.senderWallet, senderWallet = _h === void 0 ? constants_1.ADDRESS_ZERO : _h, _j = _a.senderToken, senderToken = _j === void 0 ? constants_1.ADDRESS_ZERO : _j, _k = _a.senderAmount, senderAmount = _k === void 0 ? '0' : _k;\n    return {\n        expiry: String(expiry),\n        nonce: String(nonce),\n        signerWallet: signerWallet,\n        signerToken: signerToken,\n        signerAmount: String(signerAmount),\n        protocolFee: String(protocolFee),\n        senderWallet: senderWallet,\n        senderToken: senderToken,\n        senderAmount: String(senderAmount),\n    };\n}\nexports.createOrder = createOrder;\nfunction createSwapSignature(unsignedOrder, signer, swapContract, chainId) {\n    return __awaiter(this, void 0, void 0, function () {\n        var sig, _a, r, s, v;\n        return __generator(this, function (_b) {\n            switch (_b.label) {\n                case 0:\n                    if (!(typeof signer === 'string')) return [3 /*break*/, 1];\n                    sig = sigUtil.signTypedData_v4(ethUtil.toBuffer(signer), {\n                        data: {\n                            types: typescript_1.EIP712Swap,\n                            domain: {\n                                name: constants_1.DOMAIN_NAME_SWAP,\n                                version: constants_1.DOMAIN_VERSION_SWAP,\n                                chainId: chainId,\n                                verifyingContract: swapContract,\n                            },\n                            primaryType: 'Order',\n                            message: unsignedOrder,\n                        },\n                    });\n                    return [3 /*break*/, 3];\n                case 1: return [4 /*yield*/, signer._signTypedData({\n                        name: constants_1.DOMAIN_NAME_SWAP,\n                        version: constants_1.DOMAIN_VERSION_SWAP,\n                        chainId: chainId,\n                        verifyingContract: swapContract,\n                    }, { Order: typescript_1.EIP712Swap.Order }, unsignedOrder)];\n                case 2:\n                    sig = _b.sent();\n                    _b.label = 3;\n                case 3:\n                    _a = ethers_1.ethers.utils.splitSignature(sig), r = _a.r, s = _a.s, v = _a.v;\n                    return [2 /*return*/, { r: r, s: s, v: String(v) }];\n            }\n        });\n    });\n}\nexports.createSwapSignature = createSwapSignature;\nfunction getSignerFromSwapSignature(order, swapContract, chainId, v, r, s) {\n    var sig = \"\".concat(r).concat(s.slice(2)).concat(ethers_1.ethers.BigNumber.from(v)\n        .toHexString()\n        .slice(2));\n    return sigUtil.recoverTypedSignature_v4({\n        data: {\n            types: typescript_1.EIP712Swap,\n            domain: {\n                name: constants_1.DOMAIN_NAME_SWAP,\n                version: constants_1.DOMAIN_VERSION_SWAP,\n                chainId: chainId,\n                verifyingContract: swapContract,\n            },\n            primaryType: 'Order',\n            message: order,\n        },\n        sig: sig,\n    });\n}\nexports.getSignerFromSwapSignature = getSignerFromSwapSignature;\nfunction isValidOrder(order) {\n    return (order &&\n        'nonce' in order &&\n        'expiry' in order &&\n        'signerWallet' in order &&\n        'signerToken' in order &&\n        'signerAmount' in order &&\n        'senderToken' in order &&\n        'senderAmount' in order &&\n        'r' in order &&\n        's' in order &&\n        'v' in order);\n}\nexports.isValidOrder = isValidOrder;\nfunction orderToParams(order) {\n    return [\n        order.nonce,\n        order.expiry,\n        order.signerWallet,\n        order.signerToken,\n        order.signerAmount,\n        order.senderToken,\n        order.senderAmount,\n        order.v,\n        order.r,\n        order.s,\n    ];\n}\nexports.orderToParams = orderToParams;\nfunction orderPropsToStrings(obj) {\n    return {\n        nonce: String(obj.nonce),\n        expiry: String(obj.expiry),\n        signerWallet: String(obj.signerWallet),\n        signerToken: String(obj.signerToken),\n        signerAmount: String(obj.signerAmount),\n        senderToken: String(obj.senderToken),\n        senderAmount: String(obj.senderAmount),\n        v: String(obj.v),\n        r: String(obj.r),\n        s: String(obj.s),\n    };\n}\nexports.orderPropsToStrings = orderPropsToStrings;\n// eslint-disable-next-line  @typescript-eslint/explicit-module-boundary-types\nfunction createClaim(_a) {\n    var _b = _a.nonce, nonce = _b === void 0 ? Date.now().toString() : _b, _c = _a.participant, participant = _c === void 0 ? constants_1.ADDRESS_ZERO : _c, _d = _a.score, score = _d === void 0 ? '0' : _d;\n    return {\n        nonce: String(nonce),\n        participant: participant,\n        score: String(score),\n    };\n}\nexports.createClaim = createClaim;\nfunction createClaimSignature(unsignedClaim, signer, poolContract, chainId) {\n    return __awaiter(this, void 0, void 0, function () {\n        var sig, _a, r, s, v;\n        return __generator(this, function (_b) {\n            switch (_b.label) {\n                case 0:\n                    if (!(typeof signer === 'string')) return [3 /*break*/, 1];\n                    sig = sigUtil.signTypedData_v4(ethUtil.toBuffer(signer), {\n                        data: {\n                            types: typescript_1.EIP712Claim,\n                            domain: {\n                                name: constants_1.DOMAIN_NAME_POOL,\n                                version: constants_1.DOMAIN_VERSION_POOL,\n                                chainId: chainId,\n                                verifyingContract: poolContract,\n                            },\n                            primaryType: 'Claim',\n                            message: unsignedClaim,\n                        },\n                    });\n                    return [3 /*break*/, 3];\n                case 1: return [4 /*yield*/, signer._signTypedData({\n                        name: constants_1.DOMAIN_NAME_POOL,\n                        version: constants_1.DOMAIN_VERSION_POOL,\n                        chainId: chainId,\n                        verifyingContract: poolContract,\n                    }, { Claim: typescript_1.EIP712Claim.Claim }, unsignedClaim)];\n                case 2:\n                    sig = _b.sent();\n                    _b.label = 3;\n                case 3:\n                    _a = ethers_1.ethers.utils.splitSignature(sig), r = _a.r, s = _a.s, v = _a.v;\n                    return [2 /*return*/, { r: r, s: s, v: String(v) }];\n            }\n        });\n    });\n}\nexports.createClaimSignature = createClaimSignature;\nfunction getSignerFromClaimSignature(claim, poolContract, chainId, v, r, s) {\n    var sig = \"\".concat(r).concat(s.slice(2)).concat(ethers_1.ethers.BigNumber.from(v)\n        .toHexString()\n        .slice(2));\n    return sigUtil.recoverTypedSignature_v4({\n        data: {\n            types: typescript_1.EIP712Claim,\n            domain: {\n                name: constants_1.DOMAIN_NAME_POOL,\n                version: constants_1.DOMAIN_VERSION_POOL,\n                chainId: chainId,\n                verifyingContract: poolContract,\n            },\n            primaryType: 'Claim',\n            message: claim,\n        },\n        sig: sig,\n    });\n}\nexports.getSignerFromClaimSignature = getSignerFromClaimSignature;\nfunction isValidClaim(claim) {\n    return (claim &&\n        'nonce' in claim &&\n        'participant' in claim &&\n        'score' in claim &&\n        'r' in claim &&\n        's' in claim &&\n        'v' in claim);\n}\nexports.isValidClaim = isValidClaim;\nfunction claimToParams(claim) {\n    return [\n        claim.nonce,\n        claim.participant,\n        claim.score,\n        claim.v,\n        claim.r,\n        claim.s,\n    ];\n}\nexports.claimToParams = claimToParams;\nfunction claimPropsToStrings(obj) {\n    return {\n        nonce: String(obj.nonce),\n        participant: String(obj.participant),\n        score: String(obj.score),\n        v: String(obj.v),\n        r: String(obj.r),\n        s: String(obj.s),\n    };\n}\nexports.claimPropsToStrings = claimPropsToStrings;\nfunction calculateCost(amount, pricing) {\n    // TODO: Formula support\n    if (typeof pricing !== 'string') {\n        return calculateCostFromLevels(amount, pricing);\n    }\n    return null;\n}\nexports.calculateCost = calculateCost;\nfunction calculateCostFromLevels(amount, levels) {\n    var totalAmount = new bignumber_js_1.default(amount);\n    var totalAvailable = new bignumber_js_1.default(levels[levels.length - 1][0]);\n    var totalCost = new bignumber_js_1.default(0);\n    var previousLevel = new bignumber_js_1.default(0);\n    if (totalAmount.gt(totalAvailable)) {\n        throw new Error(\"Requested amount (\".concat(totalAmount.toFixed(), \") exceeds maximum available (\").concat(totalAvailable.toFixed(), \").\"));\n    }\n    // Steps through levels and multiplies each incremental amount by the level price\n    // Levels takes the form of [[ level, price ], ... ] as in [[ '100', '0.5' ], ... ]\n    for (var i = 0; i < levels.length; i++) {\n        var incrementalAmount = void 0;\n        if (totalAmount.gt(new bignumber_js_1.default(levels[i][0]))) {\n            incrementalAmount = new bignumber_js_1.default(levels[i][0]).minus(previousLevel);\n        }\n        else {\n            incrementalAmount = new bignumber_js_1.default(totalAmount).minus(previousLevel);\n        }\n        totalCost = totalCost.plus(new bignumber_js_1.default(incrementalAmount).multipliedBy(levels[i][1]));\n        previousLevel = new bignumber_js_1.default(levels[i][0]);\n        if (totalAmount.lt(previousLevel))\n            break;\n    }\n    return totalCost.decimalPlaces(6).toFixed();\n}\nexports.calculateCostFromLevels = calculateCostFromLevels;\nfunction getLowest(objects, key) {\n    var best;\n    var bestAmount;\n    var amount;\n    for (var _i = 0, objects_1 = objects; _i < objects_1.length; _i++) {\n        var obj = objects_1[_i];\n        if (!obj[key])\n            continue;\n        if (obj[key].amount != undefined) {\n            // if its a quote, it has .amount\n            amount = ethers_1.ethers.BigNumber.from(obj[key].amount);\n        }\n        else {\n            // if its an order, it has .data\n            amount = ethers_1.ethers.BigNumber.from(obj[key].data.slice(0, 66));\n        }\n        if (!best || amount.lt(bestAmount)) {\n            bestAmount = amount;\n            best = obj;\n        }\n    }\n    return best;\n}\nfunction getHighest(objects, key) {\n    var best;\n    var bestAmount;\n    var amount;\n    for (var _i = 0, objects_2 = objects; _i < objects_2.length; _i++) {\n        var obj = objects_2[_i];\n        if (!obj[key])\n            continue;\n        if (obj[key].amount != undefined) {\n            // if its a quote, it has .amount\n            amount = ethers_1.ethers.BigNumber.from(obj[key].amount);\n        }\n        else {\n            // if its an order, it has .data\n            amount = ethers_1.ethers.BigNumber.from(obj[key].data.slice(0, 66));\n        }\n        if (!best || amount.gt(bestAmount)) {\n            bestAmount = amount;\n            best = obj;\n        }\n    }\n    return best;\n}\nfunction getBestByLowestSenderAmount(objects) {\n    return getLowest(objects, 'sender');\n}\nexports.getBestByLowestSenderAmount = getBestByLowestSenderAmount;\nfunction getBestByLowestSignerAmount(objects) {\n    return getLowest(objects, 'signer');\n}\nexports.getBestByLowestSignerAmount = getBestByLowestSignerAmount;\nfunction getBestByHighestSignerAmount(objects) {\n    return getHighest(objects, 'signer');\n}\nexports.getBestByHighestSignerAmount = getBestByHighestSignerAmount;\nfunction getBestByHighestSenderAmount(objects) {\n    return getHighest(objects, 'sender');\n}\nexports.getBestByHighestSenderAmount = getBestByHighestSenderAmount;\nfunction toDecimalString(value, decimals) {\n    return ethers_1.ethers.utils.formatUnits(value.toString(), decimals).toString();\n}\nexports.toDecimalString = toDecimalString;\nfunction toAtomicString(value, decimals) {\n    return ethers_1.ethers.utils.parseUnits(value.toString(), decimals).toString();\n}\nexports.toAtomicString = toAtomicString;\nfunction getTimestamp() {\n    return Math.round(Date.now() / 1000).toString();\n}\nexports.getTimestamp = getTimestamp;\nfunction numberToBytes32(number) {\n    var hexString = number.toString(16);\n    return \"0x\".concat(hexString.padStart(64, '0'));\n}\nexports.numberToBytes32 = numberToBytes32;\nfunction parseUrl(locator) {\n    if (!/(http|ws)s?:\\/\\//.test(locator)) {\n        locator = \"https://\".concat(locator);\n    }\n    return url.parse(locator);\n}\nexports.parseUrl = parseUrl;\nfunction getEtherscanURL(chainId, hash) {\n    return \"https://\".concat(constants_1.etherscanDomains[chainId], \"/tx/\").concat(hash);\n}\nexports.getEtherscanURL = getEtherscanURL;\nfunction getEtherscanWalletURL(chainId, address) {\n    return \"https://\".concat(constants_1.etherscanDomains[chainId], \"/address/\").concat(address);\n}\nexports.getEtherscanWalletURL = getEtherscanWalletURL;\nfunction lowerCaseAddresses(obj) {\n    for (var key in obj) {\n        if (typeof obj[key] === 'object') {\n            lowerCaseAddresses(obj[key]);\n        }\n        else if (typeof obj[key] === 'string' && obj[key].indexOf('0x') === 0) {\n            obj[key] = obj[key].toLowerCase();\n        }\n        else {\n            obj[key] = obj[key].toString();\n        }\n    }\n    return obj;\n}\nexports.lowerCaseAddresses = lowerCaseAddresses;\n//# sourceMappingURL=index.js.map"]},"metadata":{},"sourceType":"script"}